# Informe Forense v0.7.2: Análisis de Alucinaciones y Corrupción de Memoria

**Fecha:** 12 de Febrero de 2026
**Versión Afectada:** v0.7.2
**Incidente:** Disonancia cognitiva del sistema, generación de hechos falsos y pérdida de contexto durante sesión crítica.

---

## 1. Resumen Ejecutivo
El sistema experimentó un fallo en cascada iniciado por la corrupción de datos en la base de datos de perfiles (SQLite). Este fallo impidió la carga del contexto real del usuario, lo que llevó al modelo a rellenar los vacíos con inferencias erróneas (alucinaciones) generadas en sesiones anteriores. La situación se agravó por un cambio de enrutamiento que derivó al usuario de un especialista terapéutico a uno genérico en medio de una crisis.

## 2. Análisis Detallado de Errores

### A. El Colapso de la Base de Datos (La "Amnesia")
**Evidencia:** `ERROR ... Expecting property name enclosed in double quotes` (src.memory.knowledge_base).

**Mecánica del Fallo:**
1.  El sistema intentó cargar el perfil estructurado del usuario desde SQLite.
2.  El parser JSON falló debido a un formato inválido en la base de datos (uso de comillas simples `'` en lugar de dobles `"`).
3.  **Resultado:** El sistema cargó un perfil por defecto (vacío). Para el LLM, el usuario "Jhonn" se convirtió en un usuario anónimo sin historial ni preferencias de trato.

### B. La Alucinación Compuesta (Confabulación)
**Hechos Inventados:** "Ex-novia que dedicó la canción", "término 'commute'", "sensación de ganar el día".

**Causa Raíz (Ingesta):**
*   El prompt en `src/memory/fact_extractor.py` instruye explícitamente: *"CLASIFICA cada hecho como... 'inferred' (es tu interpretación del texto)."*
*   En una sesión previa, el sistema "interpretó" que cantar rancheras implicaba desamor y creó el dato falso de la ex-novia.
*   Aunque el perfil JSON falló, el sistema RAG (búsqueda vectorial) **sí funcionó** y recuperó este dato corrupto ("la ex de la ranchera") como un hecho confirmado, presentándoselo al usuario.

### C. La Fractura de Personalidad (Error de Enrutamiento)
**Secuencia:**
1.  **Crisis:** El usuario expresa duda existencial. El sistema responde con el especialista `CBT` (Terapia).
2.  **Queja:** El usuario responde *"en serio todo? no pareces muy util"*.
3.  **Fallo:** El enrutador (`EnhancedRouter`) clasificó esto como una interacción de `CHAT` genérica (queja de servicio) y transfirió el control al `chat_specialist`.
4.  **Disonancia:** El `chat_specialist` tiene instrucciones de ser "conciso y cortar divagaciones", lo que resultó en una respuesta defensiva y fría, rompiendo la alianza terapéutica.

### D. Latencia y Reintentos (El "Loop" Invisible)
**Evidencia:** `Retrying request to /openai/v1/chat/completions in 36.000000 seconds`.

*   El sistema saturó la cuota de la API (Groq) intentando procesar la memoria en segundo plano.
*   Aunque no bloqueó el chat, retrasó la "corrección" de los hechos falsos en la base de datos, dejando al sistema temporalmente convencido de sus propias mentiras.

---

## 3. Conclusiones Técnicas para la Siguiente Fase

1.  **La Inferencia es Peligrosa:** Permitir que el sistema "interprete" hechos para la memoria a largo plazo es la causa directa de las alucinaciones persistentes.
2.  **Fragilidad del JSON:** El sistema de persistencia carece de mecanismos de recuperación ante errores de formato, lo que provoca amnesia total por un solo carácter erróneo.
3.  **Rigidez del Enrutador:** El cambio de especialista basado puramente en la intención semántica del último mensaje ignora el "estado emocional" de la sesión, provocando cambios de tono bruscos.

Este informe sirve como base para la **Fase de Reparación de Memoria y Cognición (v0.7.3)**.
