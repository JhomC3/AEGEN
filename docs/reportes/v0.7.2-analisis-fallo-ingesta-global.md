# Informe Técnico v0.7.2: Fallo de Ingesta de Conocimiento Global

**Fecha:** 15 de Febrero de 2026
**Componente Afectado:** `GlobalKnowledgeLoader` (Sistema de Memoria RAG)
**Impacto:** El sistema ignora documentos de conocimiento base (libros, guías), impidiendo que los especialistas accedan a información técnica crítica.

---

## 1. Descripción del Problema
A pesar de que existen archivos PDF válidos en el directorio `storage/knowledge/`, el sistema reporta consistentemente en sus logs de arranque:
`Sincronización finalizada. Procesados: 0`

Esto resulta en que durante las interacciones con el usuario, el sistema de Recuperación Aumentada (RAG) reporta:
`[CBT-RAG] Injecting context: 0 global + X user fragments`

El sistema está operando únicamente con la memoria a corto plazo y el historial del usuario, sin acceso a la bibliografía especializada (Protocolo Unificado de Barlow, Guías Esenciales).

## 2. Análisis de Causa Raíz

### A. Filtro de Seguridad por Regex (Falso Positivo)
El archivo `src/memory/global_knowledge_loader.py` implementa un mecanismo de seguridad diseñado para evitar la ingesta accidental de archivos privados de usuarios.

**Lógica actual (Línea 74):**
```python
# 2. Ignorar archivos con IDs de usuario (números largos)
if re.search(r"\d{5,}", name):
    return False
```

**Conflicto:**
Los archivos presentes en el servidor contienen ISBNs y códigos numéricos largos en sus nombres:
*   `CORE_Unified Protocol...9780190685973...pdf`

El sistema interpreta el ISBN (`9780190685973`) como un ID de usuario de Telegram (que suelen ser números largos), y por tanto **descarta silenciosamente el archivo** para proteger la privacidad.

### B. Falta de Excepciones para Archivos "CORE"
El sistema no distingue entre un archivo subido por un usuario (que debe ser filtrado) y un archivo de sistema (marcado con el prefijo `CORE_`), aplicando la misma regla restrictiva a ambos.

## 3. Evidencia Técnica

1.  **Logs de Arranque:** Ausencia de mensajes de "Ingeridos X fragmentos" y presencia de conteo cero.
2.  **Código Fuente:** Verificación de la función `_should_process_file` en `GlobalKnowledgeLoader`.
3.  **Logs de Chat:** Confirmación explícita de `0 global fragments` en la inyección de contexto del especialista CBT.

## 4. Plan de Mitigación

### Acción Inmediata (Usuario)
Renombrar los archivos en el servidor para eliminar cadenas numéricas largas innecesarias.
*   *Incorrecto:* `CORE_Unified_Protocol_9780190685973.pdf`
*   *Correcto:* `CORE_Unified_Protocol_Barlow.pdf`

### Acción Correctiva (Código - v0.7.3)
Modificar `src/memory/global_knowledge_loader.py` para implementar una "Lista Blanca" lógica:
1.  Si el archivo comienza con el prefijo `CORE_` (estándar del proyecto), **omitir la verificación de ID numérico**.
2.  Esto permite mantener la seguridad para archivos temporales mientras se garantiza la ingesta de la bibliografía oficial.

---
*Este informe sirve como insumo para el ticket de reparación v0.7.3.*
